<main class="bg-white min-h-screen md:flex scroll-smooth">
  <!-- ✅ Accordion للموبايل -->
  <section class="block md:hidden py-4">
    <div class="w-full max-w-xl mx-auto space-y-4 bg-[#e0e0e0] px-2">
      <details class="group rounded-lg overflow-hidden">
        <summary
          class="cursor-pointer select-none flex justify-between items-start px-4 py-6 bg-transparent text-gray-800 hover:bg-gray-200 transition-all ease duration-700">
          <div class="flex justify-between gap-3 font-bold">
            <span class="capitalize">Order Summary</span>
            <i class="fa-solid fa-chevron-down mt-1"></i>
          </div>
          <h2 class="font-bold">LE {{ estimatedTotal + shippingCost | number: '1.2-2' }}</h2>
        </summary>
        <section class="w-full bg-neutral-200 px-4 py-8 sm:px-6 lg:px-8">
          <article class="space-y-2">
            <ul class="space-y-4">
              <li *ngFor="let item of cartItems"
                class="flex items-center gap-4 p-2 rounded-md hover:bg-neutral-400 transition-all ease-in duration-200">
                <div class="relative">
                  <img [src]="item.productImageUrl" alt="" class="size-16 rounded-sm object-cover" />
                  <span
                    class="absolute top-[-8px] end-[-8px] bg-black text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] font-bold shadow-md ring-2 ring-white">
                    {{ item.quantity }}
                  </span>
                </div>
                <div class="flex flex-col justify-between flex-1">
                  <div>
                    <h3 class="text-sm font-bold text-black">{{ item.productName }}</h3>
                    <p class="text-[10px] text-gray-600">Size: {{ item.productSizeName }}</p>
                    <h3 class="text-sm font-bold text-black">LE {{ item.unitPrice | number: '1.2-2' }} EGP</h3>
                  </div>
                </div>
                <div class="font-bold">LE {{ item.totalPriceForOneItemType | number: '1.2-2' }}</div>
              </li>
            </ul>
          </article>
        </section>
      </details>
    </div>
  </section>

  <!-- ✅ فورم البيانات -->
  <section class="bg-white mt-10 md:w-full">
    <section class="px-3 grid justify-center">
      <form class="mb-5 overflow-hidden">
        <div class="flex items-center justify-between">
          <h2 class="font-bold text-2xl ms-4">Contact</h2>
          <a href="#" class="underline pe-8">Log in</a>
        </div>
        <div class="flex flex-col items-center justify-center">
          <input type="email" [(ngModel)]="order.customerInfo.email" name="email" placeholder="Email"
            class="mt-5 h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
          <input type="text" [(ngModel)]="order.customerInfo.firstName" name="firstName" placeholder="First Name"
            class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
          <input type="text" [(ngModel)]="order.customerInfo.lastName" name="lastName" placeholder="Last Name"
            class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
          <input type="text" [(ngModel)]="order.customerInfo.phoneNumber" name="phone" placeholder="Phone Number"
            pattern="^01[0125][0-9]{8}$" maxlength="11"
            class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
        </div>

        <!-- Delivery Section -->
        <h2 class="font-bold text-2xl ms-4 my-4">Delivery</h2>
        <div class="flex flex-col items-center justify-center">
          <select class="h-auto w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5">
            <option value="Egypt" selected>Egypt</option>
          </select>
  <select [(ngModel)]="selectedAddressId" name="selectedAddressId"
            (change)="onAddressChange()"
            *ngIf="!useNewAddress"
            class="h-auto w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5">
            <option value="" disabled selected>Select Address</option>
            <option *ngFor="let addr of savedAddresses" [value]="addr.id">{{ addr.name }}</option>
            <option value="new">Use New Address</option>
          </select>

          <label class="flex items-center space-x-2 mb-4">
            <input type="checkbox" [(ngModel)]="useNewAddress" name="useNewAddress" (change)="onToggleNewAddress()">
            <span class="text-sm">Add New Address</span>
          </label>

          <!-- Address Details -->
          <div class="w-full flex flex-col items-center" *ngIf="useNewAddress || selectedAddressId">
            <h2 class="font-bold text-2xl my-4">Address Details</h2>
            <input type="text" [(ngModel)]="order.addressInfo.street" name="street" placeholder="Street Address"
              class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
            <input type="text" [(ngModel)]="order.addressInfo.apartment" name="apartment" placeholder="Apartment"
              class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
            <input type="text" [(ngModel)]="order.addressInfo.building" name="building" placeholder="Building"
              class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
            <input type="text" [(ngModel)]="order.addressInfo.floor" name="floor" placeholder="Floor"
              class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />

            <select [(ngModel)]="order.addressInfo.governrateShippingCostId" name="governorate"
              class="h-auto w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5">
              <option value="" disabled selected>Please Select Your Governorate</option>
              <option *ngFor="let gov of governorates" [value]="gov.id">{{ gov.name }}</option>
            </select>

            <input type="text" [(ngModel)]="order.addressInfo.city" name="city" placeholder="City"
              class="h-12 w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5 placeholder:text-neutral-400" />
          </div>
          <!-- Payment Method -->
          <h2 class="font-bold text-2xl my-4">Payment Method</h2>
          <select [(ngModel)]="orderForm.paymentMethod" name="paymentMethod"
            class="h-auto w-80 rounded-md border border-neutral-400 sm:text-sm p-4 mb-5">
            <option [ngValue]="null" disabled>Select Payment Method</option>
            <option *ngFor="let method of paymentMethods" [ngValue]="method.value">
              {{ method.label }}
            </option>
          </select>

          <!-- Shipping Cost -->
          <div class="flex items-center justify-between w-full px-4">
            <h5 class="font-bold text-2xl my-4">Shipping Cost</h5>
            <span class="font-bold text-3xl">{{ shippingCost | number: '1.2-2' }} EGP</span>
          </div>

          <button type="button" (click)="completeCheckout()"
            class="mt-4 w-80 rounded-md bg-black py-2 px-4 text-sm text-white transition-all hover:bg-slate-700">
            Complete Order
          </button>
        </div>
      </form>
    </section>
  </section>

  <!-- ✅ Order Summary for Desktop -->
  <!-- ... باقي الكود كما هو بدون تغيير -->
</main>
